<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>

  <title>Multimedia Uploader</title>
  <style>
    .modal-title,
    .close-modal {
      font-size: 16px;
    }
    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
    }
    .select-label {
      /*background-color: lightcoral;*/
      text-align: right;
      font-size: 12px;
      font-weight: bold;
      padding-top: 7px;
    }
    .select-btn {
      /*background-color: darkcyan;*/
    }
    .select-file {
      display: inline-block;
      color: #fff;
      background-color: #2e558c;
      border: 1px solid #254674;
      border-radius: 3px;
      font-weight: normal;
      cursor: pointer;
      /*background-color: mediumturquoise;*/
    }
    #current {
      /*background-color: rebeccapurple;*/
    }
    #select-file-section {
    }
    #media-data-section {
      padding-left: -30px;
    }
    .hide {
      visibility: hidden;
    }
    .spacing {
      padding-top: 40px;
    }
    .file-data,
    .file-progress,
    .ready-text {
      font-size: 0.85em;
    }
    .file-data {
      display: inline-block;
      background-color: #a3d8a3;
      border: 1px solid #82c982;
      border-radius: 3px;
      color: white;
      height: 40px;
    }
    progress[value] {
      height: 30px;
    }
    .ready-text {
      color: #a3d8a3;
    }
    .js-current-label {
      text-align: right;
      font-size: 0.85em;
      font-weight: bold;
      padding: 12px 0;
      /*background-color: darkkhaki;*/
    }
    .js-current-preview {
      padding-bottom: 20px;
      /*background-color: lightsalmon;*/
    }
    #js-output-file {
      max-width:150px;
    }

  </style>
</head>

<body>
  <div class="container">

    <!-- launch button for modal -->
    <p>
      <button type="button" class="btn btn-primary" id="js-select-file" data-target="#upload-file" data-toggle="modal">Upload File</button>
    </p>

    <!-- modal header -->
    <div class="modal fade" id="upload-file" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">

          <div id="js-create-header" class="modal-header">
            <script type="text/html">
              <h4 class="modal-title">Upload <%= filetype %></h4>
              <button type="button" class="close close-modal" data-dismiss="modal">&times;</button>
            </script>
          </div>

          <div class="modal-body">
            <div id="select-file-section" class="row"></div>
            <div id="media-data-section" class="row col-sm-8 pull-right"></div>
            <div id="selected-media-section" class="row col-sm-12"></div>

            <!-- select new file -->
            <div id="js-select-file-section">
              <script type="text/html">
                <div class="select-label col-sm-4">
                  Select new <%= filetype %>
                </div>
                <div class="select-btn col-sm-4">
                  <label for="js-file-upload" id="js-file-upload-label"class="select-file button btn-sm">
                    Select File
                  </label>
                  <input id="js-file-upload" type="file" accept="image/*" capture="camera" style="visibility:hidden;">
                </div>
              </script>
            </div>
              
              <!-- create data, progress, ready text container -->
            <div id="js-media-data-section" class="container">
              <script type="text/html">
                <div id="js-file-data" class="file-data row col-sm-12">
                  <span class="glyphicon glyphicon-ok"></span> <%= fileName %> [<%= fileSize %>] MB
                </div>
                <div id="js-file-progress" class="row">
                  <progress class="col-sm-11" value="10000" max="<%= fileSize %>"></progress>
                </div>
                <div id="js-file-ready-text" class="ready-text row">
                  Ready to upload. Click <strong>Begin Upload</strong> to start.
                </div>
                </script>
            </div>

            <!-- selection section container -->
            <div id="js-selected-media-section">
              <script type="text/html">
                <div id="js-current-label" class="js-current-label col-sm-4">
                  Current <%= filetype %>
                </div>
                <div id="js-current-preview" class="js-current-preview col-sm-4">
                  <img id="js-output-file"/>
                </div>
                <div id="js-current-btn" class="col-sm-4">
                  <button id="js-full-image" class="button btn-sm"><a href="#">View Full Size</a></button>
                </div>
              </script>
            </div>
          </div><!-- close modal-body -->

          <div class="modal-footer">
            <!-- <span class="glyphicon glyphicon-cloud-upload"></span> -->
            <input id="submit-file" class="btn btn-sm btn-default" type="submit" value="Begin Upload"> 
            <input type="button" value="Close" class="btn btn-sm btn-default" data-dismiss="modal">
          </div>

        </div><!-- close modal-content -->
      </div><!-- close modal-dialog -->
    </div><!-- close modal -->
  </div><!-- close container -->

  <script>
    var MultimediaUploader = function(opts) {
      'use strict';

      var self = {},
          _private = {};

      // init
      self.init = function (filetype) {
        $(document).ready(function() {
          createModalHeader(filetype);
        });
        $(document).on('click', opts.selectFileSelector, function() {
          _private.createSelectFileSection(filetype);
        });
        $(document).on('change', opts.fileFieldSelector, function(event) {
          _private.createSelectionRow(filetype);
          _private.collectFileData(event);
        });
        $(document).on('click', opts.fullSizeImage, _private.showFullSize);
      };

      // public functions
      var createModalHeader = function(filetype) {
        var selectHeader = $('#js-create-header');
        var selectHeaderTemplate = _.template(selectHeader.text());
        console.log(selectHeaderTemplate);
        $(selectHeader).html(selectHeaderTemplate(
          {filetype: filetype}
        ));
        console.log('Create Modal Header function working!');
      }

      // private functions
      // create select file section
      _private.createSelectFileSection = function(filetype) {
        var selectFileRow = $('#js-select-file-section');
        var fileRow = $('#select-file-section');
        var selectFileTemplate = _.template(selectFileRow.text());
        $(fileRow).html(selectFileTemplate(
          {filetype: filetype}
        ));
        console.log('Create File Section function working!');
      }  
  
      // create selection row
      _private.createSelectionRow = function(filetype) {
        var selectionRow = $('#js-selected-media-section');
        var mediaRow = $('#selected-media-section');
        var selectionTemplate = _.template(selectionRow.text());
        $(mediaRow)
          .addClass("spacing")
          .html(selectionTemplate(
            {filetype: filetype}
            ));
        console.log('Scoped Selection Section function working!');
      }

      // get data from file selector
      _private.collectFileData = function(event) {
        var reader = new FileReader();
        reader.onload = function() {
          var image = $('#js-output-file')[0];
          image.src = reader.result;
        }
        var file = event.target.files[0];
        reader.readAsDataURL(file);
        var attributes = {
          'name': file.name,
          'size': file.size,
        };
        console.log('Scoped Collect File Data function working!');
        _private.createSelectFileElements(attributes);
      }

      // show data, progress bar, and ready text
      _private.createSelectFileElements = function(attributes) {
        console.log('Scoped Upload File Data function working!');
        var fileName = attributes["name"];
        var fileSize = attributes["size"];
        var dataRow = $('#js-media-data-section');
        var mediaData = $('#media-data-section');
        var dataTemplate = _.template(dataRow.text());
        $(mediaData).html(dataTemplate(
          {fileName: fileName,
           fileSize: fileSize,
           filetype: "image"}
          ));
      }

      // open full sized image in new browser window
      _private.showFullSize = function() {
        console.log('Scoped Full Size Image function working!');
      }
      return self;
    }

    $(function () {
      var mediaUploader = new MultimediaUploader({
        selectHeaderSelector: "#js-create-header",
        selectFileSelector: "#js-select-file",
        selectionSectionSelector: "#js-file-upload-label",
        submitFileSelector: "#submit-file",
        fileFieldSelector: "#js-file-upload",
        fullSizeImage: "#js-full-image",
        fileDataSelector: "#js-file-data",
        progressBarSelector: "#js-file-progress",
        readyTextSelector: "#js-file-ready-text",
      });
      mediaUploader.init("audio");
    })

  </script>

</body>
</html>